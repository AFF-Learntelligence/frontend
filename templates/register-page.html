<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="../assets/css/register-page.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Open Sans:wght@400;600&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;600&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Archivo:wght@400&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@500&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Nunito Sans:wght@700&display=swap"
    />

    <style>
      @font-face {
        font-family: "Font Awesome 5 Free";
        src: url("../assets/public/Font Awesome 5 Free-Regular-400.otf");
        font-weight: 400;
      }
    </style>
  </head>
  <body>
    <div class="register-page">
      <div class="main">
        <a class="logo4">LOGO</a>
        <form class="registration-form" id="registrationForm">
            <div class="password-fields-wrapper">
            <div class="password-fields">
                <div class="login-info">
                <a class="register" href="/templates/register-page.html">Register</a>
                <div class="login-prompt">
                    <div class="if-you-already">If you already have an account</div>
                    <div class="you-can-login-container">
                    <span class="you-can1">You can </span>
                    <a class="login-here" href="/templates/sign-in-page.html">Login here!</a>
                    </div>
                </div>
                </div>
                    <div class="email-parent2">
                      <div class="email4">Email</div>
                        <div class="email-input">
                            <div class="email-message">
                            <img
                                class="message-1-icon4"
                                alt=""
                                src="../assets/public/message-1.svg"
                            />
                            </div>
                            <input
                            class="email-input-value"
                            id="email-input-value"
                            placeholder="Enter your email address"
                            type="email"
                            required
                            />
                        </div>
                      <div class="instance-child2"></div>
                      <span class="password-error" id="email-registered-message">Email already in use</span>
                      </div>
                    <div class="instance-group">
                    <div class="username-parent">
                        <div class="username">Name</div>
                        <input
                        class="name-input-value"
                        id="name-input-value"
                        placeholder="Enter your Name"
                        type="text"
                        required
                        />
        
                        <div class="instance-child3"></div>
                        <img
                        class="message-1-icon5"
                        alt=""
                        src="../assets/public/message-1.svg"
                        />
                    </div>
                    <img class="user-1-icon" alt="" src="../assets/public/user-1.svg" />
                    </div>
                    <div class="confirm-password">
                    <div class="register-button">
                        <div class="password2">Password</div>
                    </div>
                    <div class="confirm-password-input">
                        <div class="padlock-icon">
                        <div class="hidden-field">
                            <img
                            class="padlock-1-icon3"
                            loading="lazy"
                            alt=""
                            src="../assets/public/padlock-1.svg"
                            />
                        </div>
                        <input
                            class="password-input-value"
                            id="password-input-value"
                            placeholder="Enter your Password"
                            type="password"
                            required
                        />
                        </div>
                    </div>
                    <div class="register-divider-wrapper">
                        <div class="register-divider"></div>
                    </div>
                    <ul class="validation-list" id="validation-list">
                        <li class="password-requirements" id="min-length">At least 8 characters</li>
                        <li class="password-requirements" id="uppercase">At least one uppercase letter</li>
                        <li class="password-requirements" id="lowercase">At least one lowercase letter</li>
                        <li class="password-requirements" id="number">At least one number</li>
                    </ul>
                    </div>
                    <div class="confirm-password1">
                    <div class="confrim-password-wrapper">
                        <div class="confrim-password1">Confirm Password</div>
                    </div>
                    <div class="frame-parent2">
                        <div class="frame-parent3">
                        <div class="padlock-1-container">
                            <img
                            class="padlock-1-icon4"
                            loading="lazy"
                            alt=""
                            src="../assets/public/padlock-1.svg"
                            />
                        </div>
                        <input
                            class="password-confirm-input-value"
                            id="password-confirm-input-value"
                            placeholder="Confirm your Password"
                            type="password"
                            required
                        />
                        </div>
                    </div>
                    <div class="register-call-to-action">
                        <div class="register-call-to-action-child"></div>
                    </div>
                    <span class="password-error" id="confirm-password-error">Password do not match.</span>
                    </div>
                    <div class="register-button-wrapper">
                    <button type="submit" class="rectangle-parent4">
                        <div class="frame-child5"></div>
                        <div class="register1">Register</div>
                    </button>
                    </div>
                </div>
            </div>
      </div>
      </form>
      <div class="footer">
        <div class="rectangle-parent5">
          <div class="frame-child6"></div>
          <div class="brand-logo">
            <img
              class="saly-10-icon4"
              loading="lazy"
              alt=""
              src="../assets/public/saly10@2x.png"
            />
          </div>
          <div class="sign-up-info">
            <h1 class="learntelligence4">Learntelligence</h1>
            <div class="empower-learning-with4">Empower Learning with AI</div>
          </div>
        </div>
      </div>
    </div>
    <script>
        var form = document.getElementById("registrationForm");

        form.addEventListener('submit', function(event) {
          event.preventDefault();
          const password = document.getElementById('password-input-value').value;
          const confirmPassword = document.getElementById('password-confirm-input-value').value;

          if (validatePassword(password) && validateConfirmPassword(password, confirmPassword)) {
            document.getElementById("email-registered-message").style.display = "none"
            const email = document.getElementById('email-input-value').value;
            const name = document.getElementById('name-input-value').value;
            submitForm(email, password, name);
          }
        })
        
        function validatePassword(password) {
          var minLength = document.getElementById('min-length')
          var uppercaseReq = document.getElementById('uppercase')
          var lowercaseReq = document.getElementById('lowercase')
          var numberReq = document.getElementById('number')

          if (password.length < 8) {
            minLength.style.display = "block";
            return false;
          } else {
            minLength.style.display = "none";
          }

          if (!/[A-Z]/.test(password)) {
            uppercaseReq.style.display = "block"
            return false;
          } else {
            uppercaseReq.style.display = "none"
          }

          if (!/[a-z]/.test(password)) {
            lowercaseReq.style.display = "block"
            return false;
          } else {
            lowercaseReq.style.display = "none"
          }

          if (!/\d/.test(password)) {
            numberReq.style.display = "block"
            return false;
          } else {
            numberReq.style.display = "none"
          }

          return true;
        }

        function validateConfirmPassword(password, confirmPassword) {
          const confirmErrorMessage = document.getElementById("confirm-password-error");

          if (password !== confirmPassword) {
              confirmErrorMessage.style.display = "block";
              return false;
          } else {
              confirmErrorMessage.style.display = "none";
              return true;
          }
        }
    
        function submitForm(email, password, name) {
          const data = {
            "email": email,
            "password" : password,
            "name": name
          }

          fetch('https://aff-learntelligence-be-3xei6xi65q-et.a.run.app/api/auth/register', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
          })
          .then(response => response.json())
          .then(data => {
            if (data.status == "201") {
              window.location.href = '/templates/sign-in-page.html'
            } else {
              if (data.message === "Email already registered!") {
                document.getElementById("email-registered-message").style.display = "block";
              } else {
                alert(data.status)
                alert(data.message)
              }
            }
          })
          .catch((error) => {
            alert('An error occurred during signup: ' + error.message);
          });
        }
    </script>
  </body>
</html>